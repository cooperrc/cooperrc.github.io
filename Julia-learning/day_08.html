
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Day_07 - Julia’s Symbolics: Computer Algebra System &#8212; Prof. Cooper</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/spiderman-icon.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Prof. Cooper</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../index.html">
   Professor Ryan C. Cooper
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../talks.html">
   Talks
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="learning-julia.html">
   Sharing my Julia learning journey
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="day_00.html">
     Day_00: Get set up
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="day_01.html">
     Day_01 - Julia in the Jupyter notebook
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="day_02.html">
     Day_02: a meta-Julia GitHub actions journey
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="day_03.html">
     Day_03: Dataframes and Plot Themes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="day_04.html">
     Day_04: Solving differential equations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="day_05.html">
     Day_05: Building a pendulum solution (linear and nonlinear)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="day_06.html">
     Day_06: Chaos in Motion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="day_07.html">
     Day_07 - Julia’s
     <code class="docutils literal notranslate">
      <span class="pre">
       Symbolics
      </span>
     </code>
     : Computer Algebra System
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/Julia-learning/day_08.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/cooperrc/cooperrc.github.io.git"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/cooperrc/cooperrc.github.io.git/issues/new?title=Issue%20on%20page%20%2FJulia-learning/day_08.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/cooperrc/cooperrc.github.io.git/master?urlpath=tree/Julia-learning/day_08.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-the-computer-do-the-hard-work">
   Let the computer do the hard work
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enter-computer-algebra-systems">
   Enter Computer Algebra Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#julia-s-cas-using-symbolics">
   Julia’s CAS
   <code class="docutils literal notranslate">
    <span class="pre">
     using
    </span>
    <span class="pre">
     Symbolics
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-a-set-of-functions-and-the-jacobian">
   Build a set of functions and the Jacobian
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-variables-x-1-and-x-2">
     1. define the variables
     <code class="docutils literal notranslate">
      <span class="pre">
       x_1
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       x_2
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-mathbf-f-x-f">
     2. define
     <span class="math notranslate nohighlight">
      \(\mathbf{f(x)}\)
     </span>
     <code class="docutils literal notranslate">
      <span class="pre">
       f
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-the-function-f-x-with-build-function">
     3. build the function
     <code class="docutils literal notranslate">
      <span class="pre">
       f_x
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       build_function
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluate-the-first-returned-output-from-build-function">
     4. evaluate the
     <em>
      first
     </em>
     returned output from
     <code class="docutils literal notranslate">
      <span class="pre">
       build_function
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluate-the-jacobian">
     Evaluate the Jacobian
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-time-varying-array-of-functions">
   Make a time-varying array of functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-a-d-dt-operator">
     Build a
     <span class="math notranslate nohighlight">
      \(d/dt\)
     </span>
     operator
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tripping-point-for-z-t-as-a-callable-variable">
     Tripping point for z(t) as a callable variable
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#work-around-for-non-callable-function-variables">
     Work-around for non-callable function variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#forming-lagrange-equations-in-julia-s-symbolics">
   Forming Lagrange equations in Julia’s
   <code class="docutils literal notranslate">
    <span class="pre">
     Symbolics
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-n-body-pendulum-kinetic-energy">
   The N-body pendulum kinetic energy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-n-body-pendulum-potential-energy">
   The N-body pendulum potential energy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#verify-the-method-with-2-bodies">
   Verify the method with 2 bodies
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Day_07 - Julia’s Symbolics: Computer Algebra System</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#let-the-computer-do-the-hard-work">
   Let the computer do the hard work
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#enter-computer-algebra-systems">
   Enter Computer Algebra Systems
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#julia-s-cas-using-symbolics">
   Julia’s CAS
   <code class="docutils literal notranslate">
    <span class="pre">
     using
    </span>
    <span class="pre">
     Symbolics
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#build-a-set-of-functions-and-the-jacobian">
   Build a set of functions and the Jacobian
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-the-variables-x-1-and-x-2">
     1. define the variables
     <code class="docutils literal notranslate">
      <span class="pre">
       x_1
      </span>
     </code>
     and
     <code class="docutils literal notranslate">
      <span class="pre">
       x_2
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#define-mathbf-f-x-f">
     2. define
     <span class="math notranslate nohighlight">
      \(\mathbf{f(x)}\)
     </span>
     <code class="docutils literal notranslate">
      <span class="pre">
       f
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-the-function-f-x-with-build-function">
     3. build the function
     <code class="docutils literal notranslate">
      <span class="pre">
       f_x
      </span>
     </code>
     with
     <code class="docutils literal notranslate">
      <span class="pre">
       build_function
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluate-the-first-returned-output-from-build-function">
     4. evaluate the
     <em>
      first
     </em>
     returned output from
     <code class="docutils literal notranslate">
      <span class="pre">
       build_function
      </span>
     </code>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#evaluate-the-jacobian">
     Evaluate the Jacobian
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#make-a-time-varying-array-of-functions">
   Make a time-varying array of functions
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-a-d-dt-operator">
     Build a
     <span class="math notranslate nohighlight">
      \(d/dt\)
     </span>
     operator
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#tripping-point-for-z-t-as-a-callable-variable">
     Tripping point for z(t) as a callable variable
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#work-around-for-non-callable-function-variables">
     Work-around for non-callable function variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#forming-lagrange-equations-in-julia-s-symbolics">
   Forming Lagrange equations in Julia’s
   <code class="docutils literal notranslate">
    <span class="pre">
     Symbolics
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-n-body-pendulum-kinetic-energy">
   The N-body pendulum kinetic energy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#the-n-body-pendulum-potential-energy">
   The N-body pendulum potential energy
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#verify-the-method-with-2-bodies">
   Verify the method with 2 bodies
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="day-07-julia-s-symbolics-computer-algebra-system">
<h1>Day_07 - Julia’s <code class="docutils literal notranslate"><span class="pre">Symbolics</span></code>: Computer Algebra System<a class="headerlink" href="#day-07-julia-s-symbolics-computer-algebra-system" title="Permalink to this headline">¶</a></h1>
<div class="section" id="let-the-computer-do-the-hard-work">
<h2>Let the computer do the hard work<a class="headerlink" href="#let-the-computer-do-the-hard-work" title="Permalink to this headline">¶</a></h2>
<p>The double-pendulum from <a class="reference internal" href="day_06.html"><span class="doc std std-doc">Day_06</span></a> was a great success. I got some experience building differential equations, pseudo-benchmarking some results, and building some excellent animations. One of the tough parts of physical simulations is getting all the math worked out correctly. Its satisfying to eliminate terms and come up with a final equation of motion, kind of like a Sudoku puzzle or Wordle game, but it takes time. When you start the next problem, you’re back to square one.</p>
</div>
<div class="section" id="enter-computer-algebra-systems">
<h2>Enter <a class="reference external" href="https://en.wikipedia.org/wiki/Computer_algebra_system">Computer Algebra Systems</a><a class="headerlink" href="#enter-computer-algebra-systems" title="Permalink to this headline">¶</a></h2>
<p>Computer Algebra Systems (CAS) allow you to create objects that follow symbolic algebra, calculus, etc. I avoided CAS programs for years because it felt so difficult to get the equations back into a numerical form. As an engineer, I mostly deal with tables, fractions, percents, etc. I don’t always need or want an exact function. That’s why CFD, FEA, and multibody dynamics are so useful to engineers.</p>
</div>
<div class="section" id="julia-s-cas-using-symbolics">
<h2>Julia’s CAS <code class="docutils literal notranslate"><span class="pre">using</span> <span class="pre">Symbolics</span></code><a class="headerlink" href="#julia-s-cas-using-symbolics" title="Permalink to this headline">¶</a></h2>
<p>There are some great examples on <a class="reference external" href="https://symbolics.juliasymbolics.org/stable/tutorials/symbolic_functions">Symbolics.jl documentation</a>. Here, I want to</p>
<ol class="simple">
<li><p>build some simple sets of functions</p></li>
<li><p>take some derivatives</p></li>
<li><p>create a callable numerical function (not a CAS object)</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">using</span> <span class="n">Plots</span><span class="p">,</span> <span class="n">DifferentialEquations</span><span class="p">,</span> <span class="n">LaTeXStrings</span><span class="p">,</span> <span class="n">Symbolics</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="build-a-set-of-functions-and-the-jacobian">
<h2>Build a set of functions and the Jacobian<a class="headerlink" href="#build-a-set-of-functions-and-the-jacobian" title="Permalink to this headline">¶</a></h2>
<p>The first thing I build is a set of functions and its Jacobian,</p>
<p><span class="math notranslate nohighlight">\(\mathbf{f}(x_1,x_2) = 
\left[
\begin{array}{c}
x_2 + x_1^{2} \\
x_1 + x_2^{2} \\
\end{array}
\right]
\)</span></p>
<p><span class="math notranslate nohighlight">\(\frac{\partial f_i}{\partial x_j} = 
\left[
\begin{array}{cc}
2 x_{1} &amp; 1 \\
1 &amp; 2 x_{2} \\
\end{array}
\right]\)</span></p>
<p>There were a few tricks to get everything in the right place and cooperating. So here is the process</p>
<ol class="simple">
<li><p>define the variables <code class="docutils literal notranslate"><span class="pre">x_1</span></code> and <code class="docutils literal notranslate"><span class="pre">x_2</span></code></p></li>
<li><p>define <span class="math notranslate nohighlight">\(\mathbf{f(x)}\)</span> <code class="docutils literal notranslate"><span class="pre">f</span></code></p></li>
<li><p>build the function <code class="docutils literal notranslate"><span class="pre">f_x</span></code> with <a class="reference external" href="https://symbolics.juliasymbolics.org/stable/tutorials/symbolic_functions/#Building-Functions-1"><code class="docutils literal notranslate"><span class="pre">build_function</span></code></a></p></li>
<li><p>evaluate the <em>first</em> returned output from <code class="docutils literal notranslate"><span class="pre">build_function</span></code></p></li>
</ol>
<div class="section" id="define-the-variables-x-1-and-x-2">
<h3>1. define the variables <code class="docutils literal notranslate"><span class="pre">x_1</span></code> and <code class="docutils literal notranslate"><span class="pre">x_2</span></code><a class="headerlink" href="#define-the-variables-x-1-and-x-2" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@variables</span> <span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
x_{1} \\
x_{2} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
</div>
<div class="section" id="define-mathbf-f-x-f">
<h3>2. define <span class="math notranslate nohighlight">\(\mathbf{f(x)}\)</span> <code class="docutils literal notranslate"><span class="pre">f</span></code><a class="headerlink" href="#define-mathbf-f-x-f" title="Permalink to this headline">¶</a></h3>
<p>Here, I use the same array definitions as Julia to build a vector of functions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="p">[</span><span class="n">x_1</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_2</span><span class="p">,</span> <span class="n">x_2</span><span class="o">^</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
x_{2} + x_{1}^{2} \\
x_{1} + x_{2}^{2} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
</div>
<div class="section" id="build-the-function-f-x-with-build-function">
<h3>3. build the function <code class="docutils literal notranslate"><span class="pre">f_x</span></code> with <a class="reference external" href="https://symbolics.juliasymbolics.org/stable/tutorials/symbolic_functions/#Building-Functions-1"><code class="docutils literal notranslate"><span class="pre">build_function</span></code></a><a class="headerlink" href="#build-the-function-f-x-with-build-function" title="Permalink to this headline">¶</a></h3>
<p>To get a reusable, numerical function, I want to define a Julia function. I could hard code it in, but then I’m back to doing all the math myself. The <code class="docutils literal notranslate"><span class="pre">build_function</span></code> is a fast Julia interpretation of the algebra contained in the CAS function. It returns a full <code class="docutils literal notranslate"><span class="pre">function</span></code> that can be saved as a <code class="docutils literal notranslate"><span class="pre">*.jl</span></code> file.</p>
<blockquote>
<div><p><strong>Note</strong>: There is a new term to me called the <a class="reference external" href="https://arxiv.org/abs/2010.07516">world-age issues</a> that has to do with <em>where</em> and <em>when</em> the function is defined. This method using <code class="docutils literal notranslate"><span class="pre">eval</span></code> creates a new <em>world</em> within the Julia session that cannot be precompiled. I believe saving this to the <code class="docutils literal notranslate"><span class="pre">*.jl</span></code> file is a workaround to this slow-down.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">f_x</span><span class="o">=</span> <span class="n">build_function</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(:(function (x_1, x_2)
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:349 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:350 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:351 =#
      begin
          #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:444 =#
          (SymbolicUtils.Code.create_array)(Array, nothing, Val{1}(), Val{(2,)}(), (+)(x_2, (^)(x_1, 2)), (+)(x_1, (^)(x_2, 2)))
      end
  end), :(function (ˍ₋out, x_1, x_2)
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:349 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:350 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:351 =#
      begin
          #= /home/ryan/.julia/packages/Symbolics/1OrKJ/src/build_function.jl:378 =#
          #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:398 =# @inbounds begin
                  #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:394 =#
                  ˍ₋out[1] = (+)(x_2, (^)(x_1, 2))
                  ˍ₋out[2] = (+)(x_1, (^)(x_2, 2))
                  #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:396 =#
                  nothing
              end
      end
  end))
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evaluate-the-first-returned-output-from-build-function">
<h3>4. evaluate the <em>first</em> returned output from <code class="docutils literal notranslate"><span class="pre">build_function</span></code><a class="headerlink" href="#evaluate-the-first-returned-output-from-build-function" title="Permalink to this headline">¶</a></h3>
<p>In this case, there are two functions:</p>
<ol class="simple">
<li><p>The first is a function f([x, y]) that computes and builds an output vector <span class="math notranslate nohighlight">\([x_1^2 + x_2,~x_2^2 + x_1]\)</span>.</p></li>
<li><p>The second function is an in-place non-allocating mutating function which mutates its first value</p></li>
</ol>
<p>I don’t need the second function at the moment, so I evaluate, <code class="docutils literal notranslate"><span class="pre">eval</span></code>, the first function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">out</span> <span class="o">=</span> <span class="n">eval</span><span class="p">(</span><span class="n">f_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2-element Vector{Float64}:
 3.0
 5.0
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="evaluate-the-jacobian">
<h3>Evaluate the Jacobian<a class="headerlink" href="#evaluate-the-jacobian" title="Permalink to this headline">¶</a></h3>
<p>Success! Now, I can calculate the Jacobian <span class="math notranslate nohighlight">\(\frac{\partial f_i}{\partial x_i}\)</span> and evaluate its result with the same steps.</p>
<p>First, create the symbolic function, <code class="docutils literal notranslate"><span class="pre">DJ</span></code>, with <code class="docutils literal notranslate"><span class="pre">.jacobian</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">DJ</span> <span class="o">=</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{cc}
2 x_{1} &amp; 1 \\
1 &amp; 2 x_{2} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>Next, <code class="docutils literal notranslate"><span class="pre">build_function</span></code> and <code class="docutils literal notranslate"><span class="pre">eval</span></code> the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">DJ_xy</span> <span class="o">=</span> <span class="n">build_function</span><span class="p">(</span><span class="n">DJ</span><span class="p">,</span> <span class="p">[</span><span class="n">x_1</span><span class="p">,</span> <span class="n">x_2</span><span class="p">])</span>
<span class="n">eval</span><span class="p">(</span><span class="n">DJ_xy</span><span class="p">[</span><span class="mi">1</span><span class="p">])([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2×2 Matrix{Int64}:
 2  1
 1  4
</pre></div>
</div>
</div>
</div>
<p>Success!</p>
</div>
</div>
<div class="section" id="make-a-time-varying-array-of-functions">
<h2>Make a time-varying array of functions<a class="headerlink" href="#make-a-time-varying-array-of-functions" title="Permalink to this headline">¶</a></h2>
<p>Now, I want to create a set of functions that vary with time, take the derivative and evaluate the results.</p>
<blockquote>
<div><p>This will give me the piece I need for the <span class="math notranslate nohighlight">\(\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q}_i}\right)\)</span> calculations.</p>
</div></blockquote>
<p>I want to build,</p>
<p>$\mathbf{g(z)} = \left[
\begin{array}{c}
\mathrm{z{_1}}\left( t \right) \mathrm{z{_2}}\left( t \right) \
2 \mathrm{z{_4}}\left( t \right) + \mathrm{z{_2}}\left( t \right) + \mathrm{z{_3}}\left( t \right) \</p>
<ul class="simple">
<li><p>\left( \mathrm{z{_4}}\left( t \right) \right)^{2} + \left( \mathrm{z{_1}}\left( t \right) \right)^{2} \
\end{array}
\right]$</p></li>
</ul>
<p>then, take the derivative,</p>
<p><span class="math notranslate nohighlight">\(\frac{d}{dt}(\mathbf{g(z)})=\left[
\begin{array}{c}
\mathrm{z{_1}}\left( t \right) \frac{dz{_2}(t)}{dt} + \mathrm{z{_2}}\left( t \right) \frac{dz{_1}(t)}{dt} \\
2 \frac{dz{_4}(t)}{dt} + \frac{dz{_2}(t)}{dt} + \frac{dz{_3}(t)}{dt} \\
2 \mathrm{z{_1}}\left( t \right) \frac{dz{_1}(t)}{dt} - 2 \mathrm{z{_4}}\left( t \right) \frac{dz{_4}(t)}{dt} \\
\end{array}
\right]\)</span></p>
<div class="section" id="build-a-d-dt-operator">
<h3>Build a <span class="math notranslate nohighlight">\(d/dt\)</span> operator<a class="headerlink" href="#build-a-d-dt-operator" title="Permalink to this headline">¶</a></h3>
<p>The next function, I make is just an operator. It takes derivatives of variables that are a function of <code class="docutils literal notranslate"><span class="pre">t</span></code>, time. Now, I can create differential equations.</p>
<p>First, define <code class="docutils literal notranslate"><span class="pre">t</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@variables</span> <span class="n">t</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
t \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>Now, define the <span class="math notranslate nohighlight">\(\frac{d}{dt}\)</span> as <code class="docutils literal notranslate"><span class="pre">Differential(t)</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span> <span class="o">=</span> <span class="n">Differential</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(::Differential) (generic function with 2 methods)
</pre></div>
</div>
</div>
</div>
<p>Now, I create four variables, <span class="math notranslate nohighlight">\(\mathbf{z} = [z_1,~z_2,~z_3,z_4]\)</span> that are functions of time. I use the shortcut to create an array of symbols <code class="docutils literal notranslate"><span class="pre">z[1:4]</span></code> and the <code class="docutils literal notranslate"><span class="pre">(t)</span></code> to indicate that each variable is a function of time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@variables</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">](</span><span class="n">t</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">zi</span> <span class="k">for</span> <span class="n">zi</span> <span class="k">in</span> <span class="n">z</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
\mathrm{z{_1}}\left( t \right) \\
\mathrm{z{_2}}\left( t \right) \\
\mathrm{z{_3}}\left( t \right) \\
\mathrm{z{_4}}\left( t \right) \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>Then, I can define the derivatives of each of these variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">dz</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
\frac{dz{_1}(t)}{dt} \\
\frac{dz{_2}(t)}{dt} \\
\frac{dz{_3}(t)}{dt} \\
\frac{dz{_4}(t)}{dt} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>Next, build the function <span class="math notranslate nohighlight">\(\mathbf{g(z)}\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="p">[</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">z</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">^</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
\mathrm{z{_1}}\left( t \right) \mathrm{z{_2}}\left( t \right) \\
2 \mathrm{z{_4}}\left( t \right) + \mathrm{z{_2}}\left( t \right) + \mathrm{z{_3}}\left( t \right) \\
 - \left( \mathrm{z{_4}}\left( t \right) \right)^{2} + \left( \mathrm{z{_1}}\left( t \right) \right)^{2} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>When I take the derivative of <code class="docutils literal notranslate"><span class="pre">g</span></code> with <code class="docutils literal notranslate"><span class="pre">D.</span></code>, it is a lazy evaluation. To get the expanded result, I call out <code class="docutils literal notranslate"><span class="pre">expand_derivatives</span></code> from Symbolics.jl.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">D</span><span class="o">.</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
\mathrm{\frac{d}{d t}}\left( \mathrm{z{_1}}\left( t \right) \mathrm{z{_2}}\left( t \right) \right) \\
\mathrm{\frac{d}{d t}}\left( 2 \mathrm{z{_4}}\left( t \right) + \mathrm{z{_2}}\left( t \right) + \mathrm{z{_3}}\left( t \right) \right) \\
\mathrm{\frac{d}{d t}}\left(  - \left( \mathrm{z{_4}}\left( t \right) \right)^{2} + \left( \mathrm{z{_1}}\left( t \right) \right)^{2} \right) \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<blockquote>
<div><p><strong>Note</strong>: “Lazy” evaluation is not a negative comment on the function. I’m just pointing out that it doesn’t fully evaluate the result until I think it’s necessary. Its a <em>feature</em> not a <em>bug</em>.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Dg</span> <span class="o">=</span> <span class="n">expand_derivatives</span><span class="o">.</span><span class="p">(</span><span class="n">D</span><span class="o">.</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
\mathrm{z{_1}}\left( t \right) \frac{dz{_2}(t)}{dt} + \mathrm{z{_2}}\left( t \right) \frac{dz{_1}(t)}{dt} \\
2 \frac{dz{_4}(t)}{dt} + \frac{dz{_2}(t)}{dt} + \frac{dz{_3}(t)}{dt} \\
2 \mathrm{z{_1}}\left( t \right) \frac{dz{_1}(t)}{dt} - 2 \mathrm{z{_4}}\left( t \right) \frac{dz{_4}(t)}{dt} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
</div>
<div class="section" id="tripping-point-for-z-t-as-a-callable-variable">
<h3>Tripping point for z(t) as a callable variable<a class="headerlink" href="#tripping-point-for-z-t-as-a-callable-variable" title="Permalink to this headline">¶</a></h3>
<p>This was a wall that I hit, hopefully you can learn from my mistakes. When I try to <code class="docutils literal notranslate"><span class="pre">build_function</span></code> and <code class="docutils literal notranslate"><span class="pre">eval</span></code> the resulting code, I get this error that <code class="docutils literal notranslate"><span class="pre">(z[1](t))</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">callable</span></code>. I believe it has to do with the assumption that <code class="docutils literal notranslate"><span class="pre">z</span></code> is a function of time on my part.</p>
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span>julia&gt; build_function(Dg, z, dz)
julia&gt; eval(Dg[1])([1,3,5,7], [2,4,6,8])

Sym z[1](t)*Differential(t)(z[2](t)) + z[2](t)*Differential(t)(z[1](t)) is not callable. Use @syms z[1](t)*Differential(t)(z[2](t)) + z[2](t)*Differential(t)(z[1](t))(var1, var2,...) to create it as a callable.

Stacktrace:
 [1] error(s::String)
   @ Base ./error.jl:33
 [2] (::SymbolicUtils.Add{Real, Int64, Dict{Any, Number}, Nothing})(::Vector{Int64}, ::Vararg{Vector{Int64}})
   @ SymbolicUtils ~/.julia/packages/SymbolicUtils/v2ZkM/src/types.jl:172
 [3] (::Num)(::Vector{Int64}, ::Vararg{Vector{Int64}})
   @ Symbolics ~/.julia/packages/Symbolics/HDE84/src/num.jl:17
 [4] top-level scope
   @ In[267]:2
 [5] eval
   @ ./boot.jl:373 [inlined]
 [6] include_string(mapexpr::typeof(REPL.softscope), mod::Module, code::String, filename::String)
   @ Base ./loading.jl:1196
</pre></div>
</div>
</div>
<div class="section" id="work-around-for-non-callable-function-variables">
<h3>Work-around for non-callable function variables<a class="headerlink" href="#work-around-for-non-callable-function-variables" title="Permalink to this headline">¶</a></h3>
<p>Here is my workaround:</p>
<ol class="simple">
<li><p>create callable variables <code class="docutils literal notranslate"><span class="pre">q</span></code> and <code class="docutils literal notranslate"><span class="pre">dq</span></code> with the same length as <code class="docutils literal notranslate"><span class="pre">z(t)</span></code></p></li>
<li><p>substitute the values into the <code class="docutils literal notranslate"><span class="pre">Dg</span></code> symbolic function and simplify the results</p></li>
<li><p>build the function with the <code class="docutils literal notranslate"><span class="pre">q</span></code> and <code class="docutils literal notranslate"><span class="pre">dq</span></code> callable variables</p></li>
</ol>
<p>I substitute the <code class="docutils literal notranslate"><span class="pre">dq</span></code> variables first, so I don’t end up with <span class="math notranslate nohighlight">\(\frac{d}{dt}(q_i)\)</span>-terms. The <code class="docutils literal notranslate"><span class="pre">susbstitute</span></code> function acts as such</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">substitute.</span></code> makes substitutions on each function within the vector <code class="docutils literal notranslate"><span class="pre">Dg</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Dict(dz[i]</span> <span class="pre">=&gt;</span> <span class="pre">dq[i])</span></code> and <code class="docutils literal notranslate"><span class="pre">Dict(z[i]</span> <span class="pre">=&gt;</span> <span class="pre">q[i])</span></code> replaces each <span class="math notranslate nohighlight">\(z_i(t)\)</span> with <span class="math notranslate nohighlight">\(q_i\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range(1,4)</span></code> loops the dictionary from <code class="docutils literal notranslate"><span class="pre">z[1]</span> <span class="pre">to</span> <span class="pre">z[4]</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@variables</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span>
<span class="nd">@variables</span> <span class="n">dq</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">Dgdq</span> <span class="o">=</span> <span class="n">simplify</span><span class="o">.</span><span class="p">(</span><span class="n">substitute</span><span class="o">.</span><span class="p">(</span><span class="n">Dg</span><span class="p">,</span> <span class="p">(</span><span class="kt">Dict</span><span class="p">(</span><span class="n">dz</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">dq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),)))</span>
<span class="n">Dgq</span> <span class="o">=</span> <span class="n">simplify</span><span class="o">.</span><span class="p">(</span><span class="n">substitute</span><span class="o">.</span><span class="p">(</span><span class="n">Dgdq</span><span class="p">,</span> <span class="p">(</span><span class="kt">Dict</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)),)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
dq{_2} q{_1} + dq{_1} q{_2} \\
2 dq{_4} + dq{_2} + dq{_3} \\
2 dq{_1} q{_1} - 2 dq{_4} q{_4} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>Finally, I can <code class="docutils literal notranslate"><span class="pre">build_function</span></code> from <code class="docutils literal notranslate"><span class="pre">Dgq</span></code> and <code class="docutils literal notranslate"><span class="pre">eval</span></code> the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Dg_func</span> <span class="o">=</span> <span class="n">build_function</span><span class="p">(</span><span class="n">Dgq</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">dq</span><span class="p">)</span>
<span class="n">eval</span><span class="p">(</span><span class="n">Dg_func</span><span class="p">[</span><span class="mi">1</span><span class="p">])([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3-element Vector{Int64}:
   10
   26
 -108
</pre></div>
</div>
</div>
</div>
<p><strong>Success!</strong></p>
</div>
</div>
<div class="section" id="forming-lagrange-equations-in-julia-s-symbolics">
<h2>Forming Lagrange equations in Julia’s <code class="docutils literal notranslate"><span class="pre">Symbolics</span></code><a class="headerlink" href="#forming-lagrange-equations-in-julia-s-symbolics" title="Permalink to this headline">¶</a></h2>
<p>Back to the goal at hand, I want to build some an <em>exact</em> differential equations, but integrate them approximately with a numerical integration tool. My <em>exact</em> differential equations are the <a class="reference external" href="https://en.wikipedia.org/wiki/Lagrangian_mechanics">Lagrange equations</a></p>
<p><span class="math notranslate nohighlight">\(\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q}_i}\right) - \frac{\partial L}{\partial q_i} = 0\)</span></p>
<p>where</p>
<p><span class="math notranslate nohighlight">\(L = T - V\)</span></p>
<p><span class="math notranslate nohighlight">\(T = \sum_{i=1}^{N}\frac{1}{2}m_iv_i^2= \sum_{i=1}^{N}\left[\mathrm{kinetic~energy}_i\right]\)</span></p>
<p><span class="math notranslate nohighlight">\(V = \sum_{i=1}^{N}\left[\mathrm{potential~energy}_i\right]\)</span></p>
</div>
<div class="section" id="the-n-body-pendulum-kinetic-energy">
<h2>The N-body pendulum kinetic energy<a class="headerlink" href="#the-n-body-pendulum-kinetic-energy" title="Permalink to this headline">¶</a></h2>
<p>Here, I wanted to extend the double pendulum to <strong>N</strong>-body pendulums. The kinetic energy is the sum of the individual kinetic energies</p>
<p><span class="math notranslate nohighlight">\(T = \sum_{i=1}^{N}\frac{1}{2}m_iv_i^2\)</span></p>
<p>where</p>
<p><span class="math notranslate nohighlight">\(v_i = \sum_{j=1}^{i} L_j\dot{\theta}_j(\cos\theta_j\hat{i} + \sin\theta_j\hat{j})\)</span></p>
<p>expanding this squared sum of kinetic energies I get</p>
<p><span class="math notranslate nohighlight">\(T = \sum_{i=1}^N\frac{1}{2}m_iL_i\dot{\theta}_i\sum_{j=1}^{i}L_j\dot{\theta}_j\cos(\theta_i - \theta_j)\)</span></p>
</div>
<div class="section" id="the-n-body-pendulum-potential-energy">
<h2>The N-body pendulum potential energy<a class="headerlink" href="#the-n-body-pendulum-potential-energy" title="Permalink to this headline">¶</a></h2>
<p>The potential energy is the height<span class="math notranslate nohighlight">\(\times\)</span>weight of the objects. Taking the base of the first body as <span class="math notranslate nohighlight">\(h=0~m\)</span>, each pendulum hangs downward at</p>
<p><span class="math notranslate nohighlight">\(h_i = \sum_{j=1}^i -L_i\cos\theta_i\)</span></p>
<p>So the potential energy is</p>
<p><span class="math notranslate nohighlight">\(V = \sum_{i=1}^{N}m_igh_i = \sum_{i=1}^{N}m_ig\sum_{j=1}^i -L_i\cos\theta_i\)</span></p>
</div>
<div class="section" id="verify-the-method-with-2-bodies">
<h2>Verify the method with 2 bodies<a class="headerlink" href="#verify-the-method-with-2-bodies" title="Permalink to this headline">¶</a></h2>
<p>Before jumping into &gt;3 body-pendulums, I built the solution for the double-pendulum in <code class="docutils literal notranslate"><span class="pre">Symbolics</span></code>. The process takes five steps:</p>
<ol class="simple">
<li><p>define the variables, <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">a[1:N](t)</span> <span class="pre">L[1:N]</span> <span class="pre">m[1:N]</span> <span class="pre">g</span></code> as time, <span class="math notranslate nohighlight">\(\theta_i\)</span>, <span class="math notranslate nohighlight">\(L_i\)</span>, <span class="math notranslate nohighlight">\(m_i\)</span> and <span class="math notranslate nohighlight">\(g=9.81~m/s^2\)</span></p></li>
<li><p>build the Lagrange, <span class="math notranslate nohighlight">\(L = T-V = \sum_{i=1}^{N}(T_i-V_i)\)</span></p></li>
<li><p>use <code class="docutils literal notranslate"><span class="pre">.jacobian</span></code> and <code class="docutils literal notranslate"><span class="pre">D.()</span></code> to form the Lagrange equations</p></li>
<li><p>replace <span class="math notranslate nohighlight">\(\theta_i(t)\)</span> and <span class="math notranslate nohighlight">\(\dot{\theta}_i\)</span> with callable variables, <code class="docutils literal notranslate"><span class="pre">q</span></code> and <code class="docutils literal notranslate"><span class="pre">dq</span></code></p></li>
<li><p>build two functions for evaluation, <span class="math notranslate nohighlight">\(\mathbf{M}(\theta_i,m_i,L_i)\)</span> and <span class="math notranslate nohighlight">\(\mathbf{rhs}(\theta_i,~\dot{\theta}_i,m_i,L_i,g)\)</span> <em>where the acceleration is</em> <span class="math notranslate nohighlight">\(\mathbf{\ddot{q}}= \mathbf{M}^{-1}\mathbf{rhs}\)</span></p></li>
</ol>
<p>The full <span class="math notranslate nohighlight">\(L = T-V\)</span> for the double pendulum is calculated as such.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>
<span class="nd">@variables</span> <span class="n">t</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="p">](</span><span class="n">t</span><span class="p">)</span> <span class="n">L</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="p">]</span> <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="p">]</span> <span class="n">g</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="n">ai</span> <span class="k">for</span> <span class="n">ai</span> <span class="k">in</span> <span class="n">a</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
\mathrm{a{_1}}\left( t \right) \\
\mathrm{a{_2}}\left( t \right) \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Lsum</span> <span class="o">=</span> <span class="n">sum</span><span class="p">([</span><span class="n">g</span><span class="o">*</span><span class="n">m</span><span class="p">[</span><span class="nb">im</span><span class="p">]</span><span class="o">*</span><span class="n">L</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="nb">im</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">im</span><span class="p">)])</span>
<span class="c"># for im in range(1, N)</span>
<span class="c">#     for i in range(1, im)</span>
<span class="c">#         for j in range(1, im)</span>
<span class="c">#             Lsum += m[im]/2*L[i]*L[j]*D(a[i])*D(a[j])*cos(a[i] - a[j]) </span>
<span class="c">#         end</span>
<span class="c">#     end</span>
<span class="c"># end</span>
<span class="n">Lsum</span><span class="o">.</span><span class="n">val</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{equation}
g \cos\left( \mathrm{a{_1}}\left( t \right) \right) L{_1} m{_1} + g \cos\left( \mathrm{a{_1}}\left( t \right) \right) L{_1} m{_2} + g \cos\left( \mathrm{a{_2}}\left( t \right) \right) L{_2} m{_2}
\end{equation}\]</div>
</div>
</div>
<p>Now, finding the <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial q_i}\)</span> terms is a <code class="docutils literal notranslate"><span class="pre">.jacobian</span></code> using the defined angles, <code class="docutils literal notranslate"><span class="pre">a</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Symbolics</span><span class="o">.</span><span class="n">jacobian</span><span class="p">([</span><span class="n">Lsum</span><span class="o">.</span><span class="n">val</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Differentiation</span> <span class="n">of</span> <span class="n">expressions</span> <span class="n">involving</span> <span class="n">arrays</span> <span class="ow">and</span> <span class="n">array</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">yet</span> <span class="n">supported</span><span class="o">.</span>

<span class="ne">Stacktrace</span>:
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">error</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">error</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">33</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Sym</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Real</span><span class="p">},</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">85</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Sym</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Real</span><span class="p">},</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
  <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
  <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="n">collect_to</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Any<span class="o">}</span>, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>SymbolicUtils.Symbolic<span class="o">{</span>Real<span class="o">}}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Base.ImmutableDict<span class="o">{</span>DataType, Any<span class="o">}}}}</span>, offs::Int64, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">782</span>
 <span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="n">collect_to</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Bool<span class="o">}</span>, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>SymbolicUtils.Symbolic<span class="o">{</span>Real<span class="o">}}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Base.ImmutableDict<span class="o">{</span>DataType, Any<span class="o">}}}}</span>, offs::Int64, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">790</span>
 <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="n">collect_to_with_first</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Bool<span class="o">}</span>, v1::Bool, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>SymbolicUtils.Symbolic<span class="o">{</span>Real<span class="o">}}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Base.ImmutableDict<span class="o">{</span>DataType, Any<span class="o">}}}}</span>, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">760</span>
 <span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Symbolic</span><span class="p">{</span><span class="n">Real</span><span class="p">}},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Symbolic</span><span class="p">{</span><span class="n">Real</span><span class="p">}},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">754</span>
 <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Symbolic</span><span class="p">{</span><span class="n">Real</span><span class="p">}},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Symbolic</span><span class="p">{</span><span class="n">Real</span><span class="p">}},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
 <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Symbolic</span><span class="p">{</span><span class="n">Real</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
 <span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="c1">#133</span>
    <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
 <span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
 <span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
 <span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Add</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="n">expand_derivatives</span><span class="p">(</span><span class="n">O</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">;</span> <span class="n">occurances</span><span class="p">::</span><span class="n">Nothing</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">137</span>
 <span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="n">expand_derivatives</span>
    <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">132</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">ops</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Add</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}},</span> <span class="nb">vars</span><span class="p">::</span><span class="n">OffsetArrays</span><span class="o">.</span><span class="n">OffsetVector</span><span class="p">{</span><span class="n">Num</span><span class="p">,</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">}};</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">409</span>
 <span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">ops</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Add</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}},</span> <span class="nb">vars</span><span class="p">::</span><span class="n">OffsetArrays</span><span class="o">.</span><span class="n">OffsetVector</span><span class="p">{</span><span class="n">Num</span><span class="p">,</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">409</span>
 <span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
    <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span><span class="mi">1</span>
 <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="nb">eval</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">373</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="n">include_string</span><span class="p">(</span><span class="n">mapexpr</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">REPL</span><span class="o">.</span><span class="n">softscope</span><span class="p">),</span> <span class="n">mod</span><span class="p">::</span><span class="n">Module</span><span class="p">,</span> <span class="n">code</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">filename</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">loading</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1196</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">dLa</span> <span class="o">=</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">jacobian</span><span class="p">([</span><span class="n">Lsum</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Differentiation</span> <span class="n">of</span> <span class="n">expressions</span> <span class="n">involving</span> <span class="n">arrays</span> <span class="ow">and</span> <span class="n">array</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">yet</span> <span class="n">supported</span><span class="o">.</span>

<span class="ne">Stacktrace</span>:
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">error</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">error</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">33</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Sym</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Real</span><span class="p">},</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">85</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Sym</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Real</span><span class="p">},</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
  <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
  <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="c1">#133</span>
    <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Union</span><span class="p">{</span><span class="n">Int64</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Union</span><span class="p">{</span><span class="n">Int64</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
 <span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="n">collect_similar</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="nb">map</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Pow</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Pow</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="n">collect_to</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Any<span class="o">}</span>, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>Any<span class="o">}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Base.ImmutableDict<span class="o">{</span>DataType, Any<span class="o">}}}}</span>, offs::Int64, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">782</span>
 <span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="n">collect_to</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Bool<span class="o">}</span>, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>Any<span class="o">}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Base.ImmutableDict<span class="o">{</span>DataType, Any<span class="o">}}}}</span>, offs::Int64, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">790</span>
 <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="n">collect_to_with_first</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Bool<span class="o">}</span>, v1::Bool, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>Any<span class="o">}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Base.ImmutableDict<span class="o">{</span>DataType, Any<span class="o">}}}}</span>, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">760</span>
 <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">754</span>
 <span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
 <span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
 <span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Rational</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Rational</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
 <span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
 <span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
 <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Add</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="n">expand_derivatives</span><span class="p">(</span><span class="n">O</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">;</span> <span class="n">occurances</span><span class="p">::</span><span class="n">Nothing</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">137</span>
 <span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="n">expand_derivatives</span><span class="p">(</span><span class="n">O</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">132</span>
 <span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">ops</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">},</span> <span class="nb">vars</span><span class="p">::</span><span class="n">OffsetArrays</span><span class="o">.</span><span class="n">OffsetVector</span><span class="p">{</span><span class="n">Num</span><span class="p">,</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">}};</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">409</span>
 <span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">ops</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">},</span> <span class="nb">vars</span><span class="p">::</span><span class="n">OffsetArrays</span><span class="o">.</span><span class="n">OffsetVector</span><span class="p">{</span><span class="n">Num</span><span class="p">,</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">409</span>
 <span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
    <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">65</span><span class="p">]:</span><span class="mi">1</span>
 <span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="nb">eval</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">373</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">36</span><span class="p">]</span> <span class="n">include_string</span><span class="p">(</span><span class="n">mapexpr</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">REPL</span><span class="o">.</span><span class="n">softscope</span><span class="p">),</span> <span class="n">mod</span><span class="p">::</span><span class="n">Module</span><span class="p">,</span> <span class="n">code</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">filename</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">loading</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1196</span>
</pre></div>
</div>
</div>
</div>
<p>Next, I define the derivative, <span class="math notranslate nohighlight">\(\dot{\theta}_i\)</span> as <code class="docutils literal notranslate"><span class="pre">da</span></code> and take the <code class="docutils literal notranslate"><span class="pre">.jacobian</span></code> to find <span class="math notranslate nohighlight">\(\frac{\partial L}{\partial \dot{q}_i}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">da</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">(</span><span class="n">ai</span><span class="p">)</span> <span class="k">for</span> <span class="n">ai</span> <span class="k">in</span> <span class="n">a</span><span class="p">]</span>

<span class="n">dLda</span> <span class="o">=</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">jacobian</span><span class="p">([</span><span class="n">Lsum</span><span class="p">],</span> <span class="n">da</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="n">Differentiation</span> <span class="n">of</span> <span class="n">expressions</span> <span class="n">involving</span> <span class="n">arrays</span> <span class="ow">and</span> <span class="n">array</span> <span class="n">variables</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">yet</span> <span class="n">supported</span><span class="o">.</span>

<span class="ne">Stacktrace</span>:
  <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="n">error</span><span class="p">(</span><span class="n">s</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">error</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">33</span>
  <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Sym</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Real</span><span class="p">},</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">85</span>
  <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Sym</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Real</span><span class="p">},</span> <span class="n">Base</span><span class="o">.</span><span class="n">ImmutableDict</span><span class="p">{</span><span class="n">DataType</span><span class="p">,</span> <span class="n">Any</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
  <span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
  <span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
  <span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
  <span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
  <span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
  <span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="c1">#133</span>
    <span class="o">@</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Union</span><span class="p">{</span><span class="n">Int64</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Union</span><span class="p">{</span><span class="n">Int64</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
 <span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="n">collect_similar</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="nb">map</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">14</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Pow</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Pow</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">17</span><span class="p">]</span> <span class="n">collect_to</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Any<span class="o">}</span>, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>Any<span class="o">}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Nothing<span class="o">}}}</span>, offs::Int64, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">782</span>
 <span class="p">[</span><span class="mi">18</span><span class="p">]</span> <span class="n">collect_to</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Bool<span class="o">}</span>, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>Any<span class="o">}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Nothing<span class="o">}}}</span>, offs::Int64, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">790</span>
 <span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="n">collect_to_with_first</span><span class="o">!(</span>dest::Vector<span class="o">{</span>Bool<span class="o">}</span>, v1::Bool, itr::Base.Generator<span class="o">{</span>Vector<span class="o">{</span>Any<span class="o">}</span>, Symbolics.var<span class="s2">&quot;#133#135&quot;</span><span class="o">{</span>SymbolicUtils.Term<span class="o">{</span>Real, Nothing<span class="o">}}}</span>, st::Int64<span class="o">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">760</span>
 <span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">754</span>
 <span class="p">[</span><span class="mi">21</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
 <span class="p">[</span><span class="mi">22</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Any</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
 <span class="p">[</span><span class="mi">23</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Rational</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">24</span><span class="p">]</span> <span class="p">(::</span><span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}})(</span><span class="n">a</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Rational</span><span class="p">{</span><span class="n">Int64</span><span class="p">},</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="n">iterate</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">generator</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">47</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">26</span><span class="p">]</span> <span class="n">_collect</span><span class="p">(</span><span class="n">c</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}},</span> <span class="c1">#unused#::Base.EltypeUnknown, isz::Base.HasShape{1})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">744</span>
 <span class="p">[</span><span class="mi">27</span><span class="p">]</span> <span class="n">collect_similar</span><span class="p">(</span><span class="n">cont</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">itr</span><span class="p">::</span><span class="n">Base</span><span class="o">.</span><span class="n">Generator</span><span class="p">{</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">},</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">var</span><span class="s2">&quot;#133#135&quot;</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">}}})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">array</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">653</span>
 <span class="p">[</span><span class="mi">28</span><span class="p">]</span> <span class="nb">map</span><span class="p">(</span><span class="n">f</span><span class="p">::</span><span class="n">Function</span><span class="p">,</span> <span class="n">A</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Mul</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">}</span> <span class="n">where</span> <span class="n">T</span><span class="o">&lt;</span><span class="p">:</span><span class="n">Number</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">2849</span>
 <span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="n">occursin_info</span><span class="p">(</span><span class="n">x</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">expr</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Add</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Int64</span><span class="p">,</span> <span class="n">Dict</span><span class="p">{</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">},</span> <span class="n">Nothing</span><span class="p">})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">75</span>
 <span class="p">[</span><span class="mi">30</span><span class="p">]</span> <span class="n">expand_derivatives</span><span class="p">(</span><span class="n">O</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">;</span> <span class="n">occurances</span><span class="p">::</span><span class="n">Nothing</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">137</span>
 <span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="n">expand_derivatives</span><span class="p">(</span><span class="n">O</span><span class="p">::</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Term</span><span class="p">{</span><span class="n">Real</span><span class="p">,</span> <span class="n">Nothing</span><span class="p">},</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">132</span>
 <span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">ops</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">},</span> <span class="nb">vars</span><span class="p">::</span><span class="n">OffsetArrays</span><span class="o">.</span><span class="n">OffsetVector</span><span class="p">{</span><span class="n">Num</span><span class="p">,</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">}};</span> <span class="n">simplify</span><span class="p">::</span><span class="n">Bool</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">409</span>
 <span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="n">jacobian</span><span class="p">(</span><span class="n">ops</span><span class="p">::</span><span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">},</span> <span class="nb">vars</span><span class="p">::</span><span class="n">OffsetArrays</span><span class="o">.</span><span class="n">OffsetVector</span><span class="p">{</span><span class="n">Num</span><span class="p">,</span> <span class="n">Vector</span><span class="p">{</span><span class="n">Num</span><span class="p">}})</span>
    <span class="o">@</span> <span class="n">Symbolics</span> <span class="o">~/.</span><span class="n">julia</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">Symbolics</span><span class="o">/</span><span class="mi">1</span><span class="n">OrKJ</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">diff</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">409</span>
 <span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span>
    <span class="o">@</span> <span class="n">In</span><span class="p">[</span><span class="mi">37</span><span class="p">]:</span><span class="mi">3</span>
 <span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="nb">eval</span>
    <span class="o">@</span> <span class="o">./</span><span class="n">boot</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">373</span> <span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
 <span class="p">[</span><span class="mi">36</span><span class="p">]</span> <span class="n">include_string</span><span class="p">(</span><span class="n">mapexpr</span><span class="p">::</span><span class="n">typeof</span><span class="p">(</span><span class="n">REPL</span><span class="o">.</span><span class="n">softscope</span><span class="p">),</span> <span class="n">mod</span><span class="p">::</span><span class="n">Module</span><span class="p">,</span> <span class="n">code</span><span class="p">::</span><span class="n">String</span><span class="p">,</span> <span class="n">filename</span><span class="p">::</span><span class="n">String</span><span class="p">)</span>
    <span class="o">@</span> <span class="n">Base</span> <span class="o">./</span><span class="n">loading</span><span class="o">.</span><span class="n">jl</span><span class="p">:</span><span class="mi">1196</span>
</pre></div>
</div>
</div>
</div>
<p>Now, I have the components to assemble, simplify and display the Lagrange equations of motion,</p>
<p><span class="math notranslate nohighlight">\(\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q}_i}\right) - \frac{\partial L}{\partial q_i} = 0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">eoms</span> <span class="o">=</span> <span class="p">[</span><span class="n">simplify</span><span class="p">(</span><span class="n">expand_derivatives</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">dLda</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">-</span> <span class="n">dLa</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">expand</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span>  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
L{_1}^{2} \mathrm{\frac{d}{d t}}\left( \frac{da{_1}(t)}{dt} \right) m{_1} + g \left( m{_1} + m{_2} \right) \sin\left( \mathrm{a{_1}}\left( t \right) \right) L{_1} - \frac{1}{2} \left( \frac{da{_2}(t)}{dt} \right)^{2} \sin\left(  - \mathrm{a{_1}}\left( t \right) + \mathrm{a{_2}}\left( t \right) \right) L{_1} L{_2} m{_2} + \frac{1}{2} \cos\left(  - \mathrm{a{_1}}\left( t \right) + \mathrm{a{_2}}\left( t \right) \right) \mathrm{\frac{d}{d t}}\left( \frac{da{_2}(t)}{dt} \right) L{_1} L{_2} m{_2} \\
L{_2}^{2} \mathrm{\frac{d}{d t}}\left( \frac{da{_2}(t)}{dt} \right) m{_2} + g \sin\left( \mathrm{a{_2}}\left( t \right) \right) L{_2} m{_2} + \frac{1}{2} \left( \frac{da{_1}(t)}{dt} \right)^{2} \sin\left(  - \mathrm{a{_1}}\left( t \right) + \mathrm{a{_2}}\left( t \right) \right) L{_1} L{_2} m{_2} + \frac{1}{2} \cos\left(  - \mathrm{a{_1}}\left( t \right) + \mathrm{a{_2}}\left( t \right) \right) \mathrm{\frac{d}{d t}}\left( \frac{da{_1}(t)}{dt} \right) L{_1} L{_2} m{_2} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>If these were linear equations of motion, I could use the CAS commands to find the exact solutions, but these are nonlinear <a class="reference internal" href="day_06.html"><span class="doc std std-doc">chaotic</span></a> equations. I need the</p>
<ul class="simple">
<li><p>mass matrix, <span class="math notranslate nohighlight">\(\mathbf{M} = \frac{\partial eom_i}{\partial \ddot{\theta}_i}\)</span></p></li>
<li><p>right-hand side equations, everything else i.e. <code class="docutils literal notranslate"><span class="pre">M*dda</span> <span class="pre">-</span> <span class="pre">eoms</span></code></p></li>
</ul>
<p>Here, I define the <span class="math notranslate nohighlight">\(\ddot{\theta}_i\)</span> vector and define <span class="math notranslate nohighlight">\(\mathbf{M}\)</span> as <code class="docutils literal notranslate"><span class="pre">M</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">dda</span> <span class="o">=</span> <span class="p">[</span><span class="n">D</span><span class="p">(</span><span class="n">dai</span><span class="p">)</span> <span class="k">for</span> <span class="n">dai</span> <span class="k">in</span> <span class="n">da</span><span class="p">]</span>

<span class="n">M</span> <span class="o">=</span> <span class="n">Symbolics</span><span class="o">.</span><span class="n">jacobian</span><span class="p">(</span><span class="n">eoms</span><span class="p">,</span> <span class="n">dda</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{cc}
L{_1}^{2} m{_1} &amp; \frac{1}{2} \cos\left(  - \mathrm{a{_1}}\left( t \right) + \mathrm{a{_2}}\left( t \right) \right) L{_1} L{_2} m{_2} \\
\frac{1}{2} \cos\left(  - \mathrm{a{_1}}\left( t \right) + \mathrm{a{_2}}\left( t \right) \right) L{_1} L{_2} m{_2} &amp; L{_2}^{2} m{_2} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>Now, I can subtract the <code class="docutils literal notranslate"><span class="pre">eoms</span></code> from <code class="docutils literal notranslate"><span class="pre">M*dda</span></code> to get the right-hand side equations, <code class="docutils literal notranslate"><span class="pre">M*dda</span> <span class="pre">-</span> <span class="pre">eoms</span></code>. Then, build substitute in callable variables <code class="docutils literal notranslate"><span class="pre">q</span></code> and <code class="docutils literal notranslate"><span class="pre">dq</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="nd">@variables</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="p">]</span>
<span class="nd">@variables</span> <span class="n">dq</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="n">N</span><span class="p">]</span>
<span class="n">Mq</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">substitute</span><span class="o">.</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> 
        <span class="p">(</span><span class="kt">Dict</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)),)))</span>

<span class="n">rhsdq</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">substitute</span><span class="o">.</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">dda</span> <span class="o">-</span> <span class="n">eoms</span><span class="p">,</span> 
        <span class="p">(</span><span class="kt">Dict</span><span class="p">(</span><span class="n">D</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">=&gt;</span> <span class="n">dq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)),)))</span>
<span class="n">rhsq</span> <span class="o">=</span> <span class="n">simplify</span><span class="p">(</span><span class="n">substitute</span><span class="o">.</span><span class="p">(</span><span class="n">rhsdq</span><span class="p">,</span> 
        <span class="p">(</span><span class="kt">Dict</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=&gt;</span> <span class="n">q</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
                <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="n">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)),)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\begin{split}\begin{equation}
\left[
\begin{array}{c}
 - g \left( m{_1} + m{_2} \right) \sin\left( q{_1} \right) L{_1} + \frac{1}{2} dq{_2}^{2} \sin\left(  - q{_1} + q{_2} \right) L{_1} L{_2} m{_2} \\
 - g \sin\left( q{_2} \right) L{_2} m{_2} - \frac{1}{2} dq{_1}^{2} \sin\left(  - q{_1} + q{_2} \right) L{_1} L{_2} m{_2} \\
\end{array}
\right]
\end{equation}\end{split}\]</div>
</div>
</div>
<p>Finally, I can <code class="docutils literal notranslate"><span class="pre">build_function</span></code> and evaluate results.</p>
<blockquote>
<div><p><strong>Note</strong>: This is where I hit the world-age issue. If I try to include the <code class="docutils literal notranslate"><span class="pre">eval</span></code> function in the pendulum differential equations, Then, I get a</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">M_N2</span> <span class="o">=</span> <span class="n">build_function</span><span class="p">(</span><span class="n">Mq</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>:(function (q, m, L)
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:349 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:350 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:351 =#
      begin
          #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:444 =#
          (SymbolicUtils.Code.create_array)(Array, nothing, Val{2}(), Val{(2, 2)}(), (*)((^)((getindex)(L, 1), 2), (getindex)(m, 1)), (*)((*)((*)((*)(1//2, (cos)((+)((*)(-1, (getindex)(q, 1)), (getindex)(q, 2)))), (getindex)(L, 1)), (getindex)(L, 2)), (getindex)(m, 2)), (*)((*)((*)((*)(1//2, (cos)((+)((*)(-1, (getindex)(q, 1)), (getindex)(q, 2)))), (getindex)(L, 1)), (getindex)(L, 2)), (getindex)(m, 2)), (*)((^)((getindex)(L, 2), 2), (getindex)(m, 2)))
      end
  end)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rhs_N2</span> <span class="o">=</span> <span class="n">build_function</span><span class="p">(</span><span class="n">rhsq</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">dq</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">g</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>:(function (q, dq, m, L, g)
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:349 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:350 =#
      #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:351 =#
      begin
          #= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:444 =#
          (SymbolicUtils.Code.create_array)(Array, nothing, Val{1}(), Val{(2,)}(), (+)((*)((*)((*)((*)(-1, g), (+)((getindex)(m, 1), (getindex)(m, 2))), (sin)((getindex)(q, 1))), (getindex)(L, 1)), (*)((*)((*)((*)((*)(1//2, (^)((getindex)(dq, 2), 2)), (sin)((+)((*)(-1, (getindex)(q, 1)), (getindex)(q, 2)))), (getindex)(L, 1)), (getindex)(L, 2)), (getindex)(m, 2))), (+)((*)((*)((*)((*)(-1, g), (sin)((getindex)(q, 2))), (getindex)(L, 2)), (getindex)(m, 2)), (*)((*)((*)((*)((*)(-1//2, (^)((getindex)(dq, 1), 2)), (sin)((+)((*)(-1, (getindex)(q, 1)), (getindex)(q, 2)))), (getindex)(L, 1)), (getindex)(L, 2)), (getindex)(m, 2))))
      end
  end)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">rhs_tmp</span> <span class="o">=</span> <span class="n">eval</span><span class="p">(</span><span class="n">rhs_N2</span><span class="p">[</span><span class="mi">1</span><span class="p">])([</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">9.81</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2-element Vector{Float64}:
 -19.62
  -9.81
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">M_2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
      <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:349 =#</span>
      <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:350 =#</span>
      <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:351 =#</span>
      <span class="k">begin</span>
          <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:444 =#</span>
          <span class="p">(</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Code</span><span class="o">.</span><span class="n">create_array</span><span class="p">)(</span><span class="kt">Array</span><span class="p">,</span> <span class="nb">nothing</span><span class="p">,</span> <span class="kt">Val</span><span class="p">{</span><span class="mi">2</span><span class="p">}(),</span> <span class="kt">Val</span><span class="p">{(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}(),</span> <span class="p">(</span><span class="o">*</span><span class="p">)((</span><span class="o">^</span><span class="p">)((</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="mi">1</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">cos</span><span class="p">)((</span><span class="o">+</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="mi">1</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">cos</span><span class="p">)((</span><span class="o">+</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="o">*</span><span class="p">)((</span><span class="o">^</span><span class="p">)((</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
      <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>M_2 (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">rhs_2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dq</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
      <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:349 =#</span>
      <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:350 =#</span>
      <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:351 =#</span>
      <span class="k">begin</span>
          <span class="cm">#= /home/ryan/.julia/packages/SymbolicUtils/v2ZkM/src/code.jl:444 =#</span>
          <span class="p">(</span><span class="n">SymbolicUtils</span><span class="o">.</span><span class="n">Code</span><span class="o">.</span><span class="n">create_array</span><span class="p">)(</span><span class="kt">Array</span><span class="p">,</span> <span class="nb">nothing</span><span class="p">,</span> <span class="kt">Val</span><span class="p">{</span><span class="mi">1</span><span class="p">}(),</span> <span class="kt">Val</span><span class="p">{(</span><span class="mi">2</span><span class="p">,)}(),</span> <span class="p">(</span><span class="o">+</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="p">(</span><span class="o">+</span><span class="p">)((</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="p">(</span><span class="n">sin</span><span class="p">)((</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">))),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="mi">1</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="o">^</span><span class="p">)((</span><span class="n">getindex</span><span class="p">)(</span><span class="n">dq</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">sin</span><span class="p">)((</span><span class="o">+</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="p">(</span><span class="o">+</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">g</span><span class="p">),</span> <span class="p">(</span><span class="n">sin</span><span class="p">)((</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="o">^</span><span class="p">)((</span><span class="n">getindex</span><span class="p">)(</span><span class="n">dq</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">sin</span><span class="p">)((</span><span class="o">+</span><span class="p">)((</span><span class="o">*</span><span class="p">)(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">q</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">L</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="n">getindex</span><span class="p">)(</span><span class="n">m</span><span class="p">,</span> <span class="mi">2</span><span class="p">))))</span>
      <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rhs_2 (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">M_2</span><span class="p">([</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span><span class="o">\</span><span class="n">rhs_2</span><span class="p">([</span><span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="mf">9.81</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2-element Vector{Float64}:
 -19.62
   0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="k">function</span> <span class="n">N2pendulum</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="mf">9.81</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">du</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">u</span><span class="p">))</span>
    <span class="n">du</span><span class="p">[</span><span class="mi">1</span><span class="o">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">M_tmp</span> <span class="o">=</span> <span class="n">M_2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
    <span class="n">rhs_tmp</span> <span class="o">=</span> <span class="n">rhs_2</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">dq</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">du</span><span class="p">[</span><span class="mi">3</span><span class="o">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">M_tmp</span><span class="o">\</span><span class="n">rhs_tmp</span>
    <span class="k">return</span> <span class="n">du</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N2pendulum (generic function with 1 method)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">N2pendulum</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="nb">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4-element Vector{Float64}:
  0.0
  0.0
  3.003446274908884e-16
 -9.81
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-julia notranslate"><div class="highlight"><pre><span></span><span class="n">Plots</span><span class="o">.</span><span class="n">theme</span><span class="p">(</span><span class="ss">:cooper</span><span class="p">)</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">];</span>
<span class="n">prob1</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="p">(</span><span class="n">N2pendulum</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">sol1</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">prob1</span><span class="p">)</span>
<span class="n">prob2</span> <span class="o">=</span> <span class="n">ODEProblem</span><span class="p">(</span><span class="n">N2pendulum</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="n">sol2</span> <span class="o">=</span> <span class="n">solve</span><span class="p">(</span><span class="n">prob2</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">()</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tspan</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">a21</span> <span class="o">=</span> <span class="p">[</span><span class="n">sol1</span><span class="p">(</span><span class="n">ti</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ti</span> <span class="k">in</span> <span class="n">t</span><span class="p">]</span>
<span class="n">a22</span> <span class="o">=</span> <span class="p">[</span><span class="n">sol2</span><span class="p">(</span><span class="n">ti</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">ti</span> <span class="k">in</span> <span class="n">t</span><span class="p">]</span>

<span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a21</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">L</span><span class="s">&quot;$</span><span class="se">\t</span><span class="s">heta_2(0) = 2.000$&quot;</span><span class="p">)</span>
<span class="n">plot!</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span>  <span class="n">label</span> <span class="o">=</span> <span class="sa">L</span><span class="s">&quot;$</span><span class="se">\t</span><span class="s">heta_2(0) = 2.001$&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s">&quot;time (s)&quot;</span><span class="p">,</span> 
    <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">L</span><span class="s">&quot;$</span><span class="se">\t</span><span class="s">heta_2$&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/day_08_61_0.svg" src="../_images/day_08_61_0.svg" /></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "julia-1.7"
        },
        kernelOptions: {
            kernelName: "julia-1.7",
            path: "./Julia-learning"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'julia-1.7'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Ryan C. Cooper<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>